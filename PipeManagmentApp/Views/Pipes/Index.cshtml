@model PipesListViewModel

<h1>Все трубы</h1>
<!-- Кнопка для показа/скрытия формы фильтрации -->
<button class="btn btn-secondary mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#filterForm" aria-expanded="false" aria-controls="filterForm">
    Фильтр труб
</button>

<!-- Форма фильтрации, которая будет скрыта по умолчанию -->
<div class="collapse" id="filterForm">
    <form method="get" class="form-inline mb-3">
        <div class="form-group" style="margin-bottom: 20px;">
            <label for="number" class="mr-2">№ Трубы:</label>
            <input type="text" name="number" class="form-control" value="@ViewBag.FilterNumber" />
        </div>
        <div class="form-group" style="margin-bottom: 20px;">
            <label for="quality" class="mr-2">Качество:</label>
            <select name="quality" class="form-control">
                <option value="">Все</option>
                <option value="Годная">Годная</option>
                <option value="Брак">Брак</option>
            </select>
        </div>
        <div class="form-group" style="margin-bottom: 20px;">
            <label for="steelGrade" class="mr-2">Марка стали:</label>
            <input type="text" name="steelGrade" class="form-control" value="@ViewBag.FilterSteelGrade" />
        </div>
        <button type="submit" class="btn btn-primary" style="margin-bottom: 20px;">Применить фильтр</button>
    </form>
</div>

<form id="pipeSelectionForm" method="post" asp-action="CreatePackage">
<div class="row">
    @foreach (var pipe in Model.allPipes)
    {
        <div class="col-md-4 mb-4">
            <div class="card @(pipe.quality == "Брак" ? "border-danger" : "border-primary")">
                <div class="card-header @(pipe.quality == "Брак" ? "text-danger" : "")">
                    Труба № @pipe.number
                </div>
          
                <div class="card-body">
                    <h5 class="card-title">Марка стали: @pipe.steelGrade</h5>
                    <p class="card-text">
                        <strong>Качество:</strong> @pipe.quality <br />
                        <strong>Размеры:</strong> @pipe.dimensions <br />
                        <strong>Вес:</strong> @pipe.weight кг
                    </p>
                </div>
                <div class="card-footer">
                    @if (pipe.quality == "Брак")
                    {
                        <span class="text-danger">Труба признана бракованной</span>
                    }
                    else
                    {
                        <span class="text-success">Годная труба</span>
                    }
                    @if (pipe.packageId.HasValue)
                    {
                        <!-- Труба в пакете, кнопки неактивны -->
                        <a href="#" class="btn btn-warning btn-sm disabled">Редактировать</a>
                        <a href="#" class="btn btn-danger btn-sm disabled">Удалить</a>
                    }
                    else
                    {
                        <!-- Труба не в пакете, кнопки активны -->
                        <a href="@Url.Action("Edit", "Pipes", new { id = pipe.id })" class="btn btn-warning btn-sm">Редактировать</a>
                        <a href="@Url.Action("Delete", "Pipes", new { id = pipe.id })" class="btn btn-danger btn-sm">Удалить</a>
                    }
                    <input type="checkbox" name="selectedPipes" value="@pipe.id" />
                </div>
            </div>
        </div>
    }
</div>

<!-- Закрепленная строка с итоговыми данными -->
<div class="fixed-bottom bg-light p-3 border-top">
    <div class="container">
        <div class="row">
            <div class="col">
                <strong>Общее количество труб:</strong> @Model.totalPipes
            </div>
            <div class="col">
                <strong>Годных труб:</strong> @Model.goodPipes
            </div>
            <div class="col">
                <strong>Бракованных труб:</strong> @Model.defectivePipes
            </div>
            <div class="col">
                <strong>Общий вес:</strong> @Model.totalWeight кг
            </div>
            <div class="col-md-12 text-right">
                <a href="@Url.Action("Create", "Pipes")" class="btn btn-primary">Добавить трубу</a>
            </div>
        </div>
    </div>
</div>
<button type="submit" id="createPackageButton" class="btn btn-primary" style="display: none;">Создать пакет</button>
</form>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const checkboxes = document.querySelectorAll('input[name="selectedPipes"]');
        const button = document.getElementById('createPackageButton');

        function updateButtonVisibility() {
            const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
            button.style.display = checkedCount >= 2 ? 'inline' : 'none';
        }

        checkboxes.forEach(cb => cb.addEventListener('change', updateButtonVisibility));
        updateButtonVisibility();
    });
</script>